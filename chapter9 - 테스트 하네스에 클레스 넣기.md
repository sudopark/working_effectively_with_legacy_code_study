## 목표

: 의존관계 제거



### 생성자 파악

1. 일단 빈 생성자로 테스트를 만들어보고 빠진 생성 인자가 무엇인지 알아보자
2. 쉽게 생성할 수 없거나 복잡한 의존관계를 지니는 경우에는 의존하는 객체의 인터페이스를 분리하자
3. 테스트 더블을 생성할시에 프로덕트 코드와는 다른 기준으로 public하게 내부 프로퍼티를 노출한다던지 테스트를 용이하게하기 위하여 별도 규칙을 이용해야할수도있다. 단 여기서 중요한점은 **명확함**을 잃지 말아야한다.

-----

### 숨겨진 의존관계

- 생성자에 드러나지 않는 의존관계들
- 최대한 생성자 주입 방식으로 바꾸어서 외부로부터 의존관계를 들어내라
- 매개변수가 추가되어서 생성하는 많은 부분을 수정해줘야할수도 있음 -> convenience init과 같은 방식으로 대체

-----

### 복잡한 의존관계

- 인스턴스 변수 대체 방식 -> 세터 추가(비추)

------

### 까다로운 전역 의존관계

- 전역상태 - 싱글톤 객체에 의존이 있는경우
  - 전역상태는 투명하지 않다 
  - 결국은 싱글턴을 죽여야함
- 초기방법: 정적 세터 추가.. 스읍.. => 이러면 싱글턴 의미가 사라짐

#### 그러면 왜 싱글턴이 필요한지 생각해보자

1. 실제 세계를 모델링한결과 실제 1개만 존재하기 때문(디비 등)
2. 두개가 존재하면 안되는 경우 -> 하드웨어적 속성에 더 의거함
3. 여러개 생성시 자원소모가 극심한경우
4. (대부분 레거시의 이유) 전역상태에 손쉽게 접근하기 위해서

=> 싱글턴을 없애라 제발

#### 해결책

1. 가짜 서브클래스를 만들거나
2. 인터페이스 추출해라

=> 코드내 광범위한 범위에서 사용되는 전역변수가 존재한다면 이는 적절히 계층화 되지 않았음을 의미

-----

### 양파껍질 매개변수

- 생성자의 인자를 생성하려면 그 인자를 생성하고 인자의 인자를 생성하고... -> 하지만 끝은 있음(안그러면 순환, 컴파일 실패)
- 의존있는 객체의 인터페이스를 추출해야할때 그 객체의 상위객체의 일부분을 이용해야한다면 인터페이스 기본구현을 이용
- 의존관계를 다시 검토해보고 제거할수있는지 판단(인터페이스 추출과 같이 제거방식이 너무 복잡해 진다면) -> 재정의 힘든 객체는 페이크 서브클래스로 대체

